<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Complete Example: Testing a Counter | Hedgehog .NET </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Complete Example: Testing a Counter | Hedgehog .NET ">
      
      
      <link rel="icon" href="../images/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/hedgehogqa/fsharp-hedgehog/blob/master/docs/stateful/complete-example.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/logo.png" alt="Hedgehog .NET">
            Hedgehog .NET
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

        </div>

        <article data-uid="">
<h1 id="complete-example-testing-a-counter">Complete Example: Testing a Counter</h1>

<p>This walkthrough will guide you through building a complete stateful test from scratch. We'll test a simple <code>Counter</code> class with increment, decrement, and reset operations.</p>
<h2 id="the-system-under-test-sut">The System Under Test (SUT)</h2>
<p>Let's start with a simple counter implementation:</p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_fsharp" role="tab" aria-controls="tabpanel_1_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_csharp" role="tab" aria-controls="tabpanel_1_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_1_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type Counter() =
    let mutable value = 0
    
    member _.Increment() = value &lt;- value + 1
    member _.Decrement() = value &lt;- value - 1
    member _.Reset() = value &lt;- 0
    member _.Get() = value
</code></pre>
</section>
<section id="tabpanel_1_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public sealed class Counter
{
    private int _value;

    public void Increment() =&gt; _value++;
    public void Decrement() =&gt; _value--;
    public void Reset() =&gt; _value = 0;
    public int Get() =&gt; _value;
}
</code></pre>
</section>
</div>

<p>This is our <strong>System Under Test</strong> (SUT). It maintains state (the current count) and provides operations that modify that state.</p>
<h2 id="the-model-state">The Model State</h2>
<p>To test our counter, we need a model that represents what we <em>expect</em> the counter's state to be. Since our counter has a single integer value, our model is simple:</p>
<div class="tabGroup" id="tabgroup_2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_2_fsharp" role="tab" aria-controls="tabpanel_2_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_csharp" role="tab" aria-controls="tabpanel_2_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_2_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type CounterState = {
    CurrentCount: Var&lt;int&gt;  // Symbolic reference to the counter's value
}
</code></pre>
</section>
<section id="tabpanel_2_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public record CounterState
{
    public required Var&lt;int&gt; CurrentCount { get; init; }
}
</code></pre>
</section>
</div>

<p>The <code>Var&lt;int&gt;</code> is a <strong>symbolic variable</strong>—it represents &quot;the value that operation X returned.&quot; This lets us track relationships between operations even before we know their concrete values.</p>
<h2 id="defining-commands">Defining Commands</h2>
<p>Now we'll define each operation as a <strong>Command</strong>.</p>
<p>Each command inherits from <code>Command&lt;TSystem, TState, TInput, TOutput&gt;</code> where:</p>
<ul>
<li><code>TSystem</code> is our system under test type (<code>Counter</code>)</li>
<li><code>TState</code> is our model state type (<code>CounterState</code>)</li>
<li><code>TInput</code> is the input parameter type for this command</li>
<li><code>TOutput</code> is what the command returns</li>
</ul>
<h3 id="the-increment-command">The Increment Command</h3>
<div class="tabGroup" id="tabgroup_3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_3_fsharp" role="tab" aria-controls="tabpanel_3_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_3_csharp" role="tab" aria-controls="tabpanel_3_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_3_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type IncrementCommand() =
    inherit Command&lt;Counter, CounterState, unit, int&gt;()

    // Name for debugging/shrinking output
    override _.Name = &quot;Increment&quot;
    
    // Always allow this command
    override _.Precondition(state) = true
    
    // Execute the real operation on the SUT
    override _.Execute(counter, env, state, input) =
        counter.Increment()
        let result = counter.Get()
        Task.FromResult(result)
    
    // Generate inputs (none needed for increment)
    override _.Gen(state) = Gen.constant ()
    
    // Update our model state with the new value
    override _.Update(state, input, outputVar) = { CurrentCount = outputVar }
    
    // Assert the result is correct
    override _.Ensure(env, oldState, newState, input, result) =
        let oldCount = oldState.CurrentCount.Resolve(env)
        result = oldCount + 1
</code></pre>
</section>
<section id="tabpanel_3_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public class IncrementCommand : Command&lt;Counter, CounterState, NoInput, int&gt;
{
    // Name for debugging/shrinking output
    public override string Name =&gt; &quot;Increment&quot;;

    // Always allow this command
    public override bool Precondition(CounterState state) =&gt; true;

    // Execute the real operation on the SUT
    public override Task&lt;int&gt; Execute(Counter sut, Env env, CounterState state, NoInput input)
    {
        sut.Increment();
        var result = sut.Get();
        return Task.FromResult(result);
    }

    // Generate inputs (none needed for increment)
    public override Gen&lt;NoInput&gt; Generate(CounterState state) =&gt;
        Gen.Constant(NoInput.Value);

    // Update our model state with the new value
    public override CounterState Update(CounterState state, NoInput input, Var&lt;int&gt; outputVar) =&gt;
        state with { CurrentCount = outputVar };

    // Assert the result is correct
    public override bool Ensure(Env env, CounterState oldState, CounterState newState, NoInput input, int result)
    {
        var oldCount = oldState.CurrentCount.Resolve(env);
        return result == oldCount + 1;
    }
}
</code></pre>
</section>
</div>

<p>Let's break down each method:</p>
<ol>
<li><strong>Name</strong>: Used in test output to show which command failed</li>
<li><strong>Precondition</strong>: Determines if this command can be generated in the current state (always <code>true</code> for simple commands)</li>
<li><strong>Execute</strong>: Runs the actual operation and returns the new count</li>
<li><strong>Gen</strong>: Generates random inputs (we use <code>unit</code> in F# or <code>NoInput</code> in C# since increment needs no meaningful input)</li>
<li><strong>Update</strong>: Takes the output and creates the new model state</li>
<li><strong>Ensure</strong>: Verifies the result is what we expected (old count + 1)</li>
</ol>
<h3 id="the-decrement-command">The Decrement Command</h3>
<p>The decrement command is almost identical:</p>
<div class="tabGroup" id="tabgroup_4">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_4_fsharp" role="tab" aria-controls="tabpanel_4_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_4_csharp" role="tab" aria-controls="tabpanel_4_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_4_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type DecrementCommand() =
    inherit Command&lt;Counter, CounterState, unit, int&gt;()

    override _.Name = &quot;Decrement&quot;
    
    override _.Precondition(state) = true
    
    override _.Execute(counter, env, state, input) =
        counter.Decrement()
        let result = counter.Get()
        Task.FromResult(result)
    
    override _.Gen _ = Gen.constant ()
    
    override _.Update(_, _, outputVar) = { CurrentCount = outputVar }
    
    override _.Ensure(env, oldState, newState, input, result) =
        let oldCount = oldState.CurrentCount.Resolve(env)
        result = oldCount - 1  // Should decrease by 1
</code></pre>
</section>
<section id="tabpanel_4_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public class DecrementCommand : Command&lt;Counter, CounterState, NoInput, int&gt;
{
    public override string Name =&gt; &quot;Decrement&quot;;

    public override bool Precondition(CounterState state) =&gt; true;

    public override Task&lt;int&gt; Execute(Counter sut, Env env, CounterState state, NoInput input)
    {
        sut.Decrement();
        var result = sut.Get();
        return Task.FromResult(result);
    }

    public override Gen&lt;NoInput&gt; Generate(CounterState state) =&gt;
        Gen.Constant(NoInput.Value);

    public override CounterState Update(CounterState state, NoInput input, Var&lt;int&gt; outputVar) =&gt;
        state with { CurrentCount = outputVar };

    public override bool Ensure(Env env, CounterState oldState, CounterState newState, NoInput input, int result)
    {
        var oldCount = oldState.CurrentCount.Resolve(env);
        return result == oldCount - 1;  // Should decrease by 1
    }
}
</code></pre>
</section>
</div>
<h3 id="the-reset-command">The Reset Command</h3>
<p>Reset is interesting because it doesn't depend on the previous state:</p>
<div class="tabGroup" id="tabgroup_5">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_5_fsharp" role="tab" aria-controls="tabpanel_5_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_5_csharp" role="tab" aria-controls="tabpanel_5_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_5_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type ResetCommand() =
    inherit Command&lt;Counter, CounterState, unit, int&gt;()

    override _.Name = &quot;Reset&quot;
    
    override _.Precondition(state) = true
    
    override _.Execute(counter, env, state, input) =
        counter.Reset()
        let result = counter.Get()
        Task.FromResult(result)
    
    override _.Gen(state) = Gen.constant ()
    override _.Update(state, input, outputVar) = { CurrentCount = outputVar }
    override _.Ensure(env, oldState, newState, input, result) = result = 0
</code></pre>
</section>
<section id="tabpanel_5_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public class ResetCommand : Command&lt;Counter, CounterState, NoInput, int&gt;
{
    public override string Name =&gt; &quot;Reset&quot;;

    public override bool Precondition(CounterState state) =&gt; true;

    public override Task&lt;int&gt; Execute(Counter sut, Env env, CounterState state, NoInput input)
    {
        sut.Reset();
        var result = sut.Get();
        return Task.FromResult(result);
    }

    public override Gen&lt;NoInput&gt; Generate(CounterState state) =&gt;
        Gen.Constant(NoInput.Value);

    public override CounterState Update(CounterState state, NoInput input, Var&lt;int&gt; outputVar) =&gt;
        state with { CurrentCount = outputVar };

    public override bool Ensure(Env env, CounterState oldState, CounterState newState, NoInput input, int result) =&gt;
        result == 0; // Reset always returns 0
}
</code></pre>
</section>
</div>
<h3 id="a-get-command-for-completeness">A Get Command (for completeness)</h3>
<p>Let's add a read-only operation to verify our model stays in sync:</p>
<div class="tabGroup" id="tabgroup_6">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_6_fsharp" role="tab" aria-controls="tabpanel_6_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_6_csharp" role="tab" aria-controls="tabpanel_6_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_6_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type GetCommand() =
    inherit Command&lt;Counter, CounterState, unit, int&gt;()

    override _.Name = &quot;Get&quot;
    
    override _.Precondition(state) = true
    
    override _.Execute(counter, env, state, input) = 
        Task.FromResult(counter.Get())
    
    override _.Gen(state) = Gen.constant ()
    
    override _.Update(state, input, outputVar) = { CurrentCount = outputVar }
    
    override _.Ensure(env, oldState, newState, input, result) =
        // Get should return exactly what's in our model
        result = oldState.CurrentCount.Resolve(env)
</code></pre>
</section>
<section id="tabpanel_6_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public class GetCommand : Command&lt;Counter, CounterState, NoInput, int&gt;
{
    public override string Name =&gt; &quot;Get&quot;;

    public override bool Precondition(CounterState state) =&gt; true;

    public override Task&lt;int&gt; Execute(Counter sut, Env env, CounterState state, NoInput input) =&gt;
        Task.FromResult(sut.Get());

    public override Gen&lt;NoInput&gt; Generate(CounterState state) =&gt;
        Gen.Constant(NoInput.Value);

    public override CounterState Update(CounterState state, NoInput input, Var&lt;int&gt; outputVar) =&gt;
        state with { CurrentCount = outputVar };

    public override bool Ensure(Env env, CounterState oldState, CounterState newState, NoInput input, int result)
    {
        // Get should return exactly what's in our model
        return result == oldState.CurrentCount.Resolve(env);
    }
}
</code></pre>
</section>
</div>
<h2 id="creating-the-specification">Creating the Specification</h2>
<p>Now we tie it all together with a <code>SequentialSpecification</code>:</p>
<div class="tabGroup" id="tabgroup_7">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_7_fsharp" role="tab" aria-controls="tabpanel_7_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_7_csharp" role="tab" aria-controls="tabpanel_7_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_7_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type CounterSpec() =
    inherit SequentialSpecification&lt;Counter, CounterState&gt;()

    // Start each test from 0
    override _.SetupCommands = [| ResetCommand() |]

    // The initial model state
    override _.InitialState = { CurrentCount = Var.symbolic 0 }

    // How many commands to generate (1-50)
    override _.Range = Range.linear 1 50

    // All available commands
    override _.Commands = [|
        IncrementCommand()
        DecrementCommand()
        ResetCommand()
        GetCommand()
    |]
</code></pre>
</section>
<section id="tabpanel_7_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public class CounterSpec : SequentialSpecification&lt;Counter, CounterState&gt;
{
    // Start each test from 0
    public override ICommand&lt;Counter, CounterState&gt;[] SetupCommands =&gt; 
        [new ResetCommand()];  

    // The initial model state
    public override CounterState InitialState =&gt; 
        new() { CurrentCount = Var.Symbolic(0) };

    // How many commands to generate (1-50)
    public override Range&lt;int&gt; Range =&gt; 
        Hedgehog.Linq.Range.LinearInt32(1, 50);

    // All available commands
    public override ICommand&lt;Counter, CounterState&gt;[] Commands =&gt;
        [
            new IncrementCommand(),
            new DecrementCommand(),
            new ResetCommand(),
            new GetCommand()
        ];
}
</code></pre>
</section>
</div>
<h2 id="running-the-test">Running the Test</h2>
<p>Finally, we write our test:</p>
<div class="tabGroup" id="tabgroup_8">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_8_fsharp" role="tab" aria-controls="tabpanel_8_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_8_csharp" role="tab" aria-controls="tabpanel_8_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_8_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">[&lt;Fact&gt;]
let ``Counter behaves correctly under random operations``() =
    let sut = Counter()
    CounterSpec().ToProperty(sut).Check()
</code></pre>
</section>
<section id="tabpanel_8_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">[Fact]
public void CounterBehavesCorrectlyUnderRandomOperations()
{
    var sut = new Counter();
    new CounterSpec().ToProperty(sut).Check();
}
</code></pre>
</section>
</div>

<p>That's it! When you run this test, Hedgehog will:</p>
<ol>
<li>Generate random sequences of commands (e.g., &quot;Increment, Increment, Reset, Decrement, Get&quot;)</li>
<li>Execute each sequence against your actual counter</li>
<li>Verify each operation produces the expected result</li>
<li>If any assertion fails, shrink the sequence to find the minimal failing case</li>
</ol>
<h3 id="example-test-scenarios">Example Test Scenarios</h3>
<p>Here are some sequences Hedgehog might generate:</p>
<p><strong>Simple sequence:</strong></p>
<pre><code>1. Reset → expect 0
2. Increment → expect 1
3. Increment → expect 2
4. Get → expect 2
</code></pre>
<p><strong>Edge case:</strong></p>
<pre><code>1. Reset → expect 0
2. Decrement → expect -1
3. Decrement → expect -2
4. Reset → expect 0
5. Get → expect 0
</code></pre>
<p><strong>Complex sequence:</strong></p>
<pre><code>1. Increment → expect 1
2. Increment → expect 2
3. Decrement → expect 1
4. Increment → expect 2
5. Reset → expect 0
6. Increment → expect 1
</code></pre>
<p>If any command returns an unexpected value, Hedgehog will report exactly which sequence caused the failure and shrink it to the smallest reproduction case.</p>
<h2 id="testing-new-behaviours">Testing new behaviours</h2>
<p>Let's assume that now <code>Counter</code> adds a new API method <code>Set</code>:</p>
<div class="tabGroup" id="tabgroup_9">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_9_fsharp" role="tab" aria-controls="tabpanel_9_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_9_csharp" role="tab" aria-controls="tabpanel_9_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_9_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type Counter() =
    member _.Set(n: int) = value &lt;- n
    // the rest of the members
</code></pre>
</section>
<section id="tabpanel_9_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public sealed class Counter
{
    public void Set(int n) =&gt; _value = n;
    // the rest of the members
}

</code></pre>
</section>
</div>

<p>To test it we need to define some <code>SetCommand</code>:</p>
<div class="tabGroup" id="tabgroup_10">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_10_fsharp" role="tab" aria-controls="tabpanel_10_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_10_csharp" role="tab" aria-controls="tabpanel_10_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_10_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">type SetCommand() =
    inherit Command&lt;Counter, CounterState, int, int&gt;()

    override _.Name = &quot;Set&quot;
    
    override _.Precondition(state) = true
    
    override _.Execute(counter, _, value) =
        counter.Set(value)
        let result = counter.Get()
        Task.FromResult(result)
    
    // Generate random integers between -10 and 100
    override _.Gen _ = Gen.int32 (Range.linearFrom 0 -10 100)
    override _.Update(_, _, outputVar) = { CurrentCount = outputVar }
    override _.Ensure(_, _, _, input, result) = result = input
</code></pre>
</section>
<section id="tabpanel_10_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public class SetCommand : Command&lt;Counter, CounterState, int, int&gt;
{
    public override string Name =&gt; &quot;Set&quot;;

    public override bool Precondition(CounterState state) =&gt; true;

    public override Task&lt;int&gt; Execute(Counter sut, Env env, int value)
    {
        sut.Set(value);
        var result = sut.Get();
        return Task.FromResult(result);
    }

    // Generate random integers between -10 and 100
    public override Gen&lt;int&gt; Generate(CounterState state) =&gt;
        Hedgehog.Linq.Gen.Int32(Range.LinearFromInt32(0, -10, 100));

    public override CounterState Update(CounterState state, int input, Var&lt;int&gt; outputVar) =&gt;
        state with { CurrentCount = outputVar };

    public override bool Ensure(Env env, CounterState oldState, CounterState newState, int input, int result)
    {
        return result == input;  // Set should set the exact value
    }
}
</code></pre>
</section>
</div>

<p>Then add <code>SetCommand()</code> to your <code>Commands</code> array in the specification.</p>
<p>Now Hedgehog will use it in generating sequence and will generate sequences like:</p>
<pre><code>1. Set(42) → expect 42
2. Increment → expect 43
3. Set(-5) → expect -5
4. Get → expect -5
</code></pre>
<h2 id="what-about-bugs">What About Bugs?</h2>
<p>Let's introduce a bug in our counter to see what happens:</p>
<div class="tabGroup" id="tabgroup_11">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_11_fsharp" role="tab" aria-controls="tabpanel_11_fsharp" data-tab="fsharp" tabindex="0" aria-selected="true">F#</a>
</li>
<li role="presentation">
<a href="#tabpanel_11_csharp" role="tab" aria-controls="tabpanel_11_csharp" data-tab="csharp" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_11_fsharp" role="tabpanel" data-tab="fsharp">

<pre><code class="lang-fsharp">member _.Decrement() = 
    if value &gt; 10 then value &lt;- value - 1
    else value &lt;- value - 2  // SIMULATE BUG: decrements by 2 when &lt;= 10
</code></pre>
</section>
<section id="tabpanel_11_csharp" role="tabpanel" data-tab="csharp" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public void Decrement()
{
    if (_value &gt; 10) _value--;
    else _value -= 2;  // SIMULATE BUG: decrements by 2 when &lt;= 10
}
</code></pre>
</section>
</div>

<p>When you run the test, Hedgehog will find this bug and report something like:</p>
<pre><code>*** Failed! Falsifiable (after 8 tests and 1 shrink):

You can reproduce this failure with the following Recheck Seed:
  &quot;7_13402950062986702852_14277380902303697685_0&quot;

Generated values:
  { Initial = CounterState { CurrentCount = 0 (symbolic) }
    Steps = [Reset ; Decrement ] }

Counterexamples:
  Final state: CounterState { CurrentCount = 0 (symbolic) }
  + Reset 
  Decrement 
</code></pre>
<p>Hedgehog automatically found the minimal reproduction case: decrement once
(you can see &quot;<code>+ Reset</code>&quot; in the list because <code>Reset</code> is defined as a Setup step and is always executed first).</p>
<h2 id="summary">Summary</h2>
<p>You've learned how to:</p>
<ol>
<li><strong>Define a model state</strong> that represents what you expect</li>
<li><strong>Create commands</strong> for each operation on your SUT</li>
<li><strong>Implement the key methods</strong> for each command:
<ul>
<li><code>Name</code>: for debugging</li>
<li><code>Precondition</code>: to control when the command can be generated</li>
<li><code>Gen</code>: to generate inputs</li>
<li><code>Execute</code>: to run the real operation</li>
<li><code>Update</code>: to update the model state</li>
<li><code>Ensure</code>: to verify correctness</li>
</ul>
</li>
<li><strong>Create a specification</strong> that ties everything together</li>
<li><strong>Run the test</strong> and let Hedgehog find bugs automatically</li>
</ol>
<p>The beauty of this approach is that Hedgehog explores hundreds or thousands of different sequences automatically, finding edge cases you might never think to test manually.</p>

</article>



      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
